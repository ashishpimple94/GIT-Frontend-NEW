{"ast":null,"code":"import React,{createContext,useState,useEffect}from'react';import api from'../config/axios';import{jsx as _jsx}from\"react/jsx-runtime\";const AuthContext=/*#__PURE__*/createContext();export const AuthProvider=_ref=>{let{children}=_ref;const[user,setUser]=useState(null);const[loading,setLoading]=useState(true);const[token,setToken]=useState(localStorage.getItem('token'));useEffect(()=>{if(token){fetchUser();}else{setLoading(false);}},[token]);const fetchUser=async()=>{try{const res=await api.get('/api/auth/me');setUser(res.data);}catch(error){localStorage.removeItem('token');setToken(null);}finally{setLoading(false);}};const login=async(username,password)=>{try{const res=await api.post('/api/auth/login',{username,password});const{token:newToken,user:userData}=res.data;localStorage.setItem('token',newToken);setToken(newToken);setUser(userData);return{success:true};}catch(error){var _error$response,_error$response2,_error$config,_error$response3,_error$response3$data;console.error('Login error:',error);console.error('Error details:',{message:error.message,response:(_error$response=error.response)===null||_error$response===void 0?void 0:_error$response.data,status:(_error$response2=error.response)===null||_error$response2===void 0?void 0:_error$response2.status,config:(_error$config=error.config)===null||_error$config===void 0?void 0:_error$config.url});return{success:false,message:((_error$response3=error.response)===null||_error$response3===void 0?void 0:(_error$response3$data=_error$response3.data)===null||_error$response3$data===void 0?void 0:_error$response3$data.message)||error.message||'Login failed. Please check your connection.'};}};const register=async userData=>{try{const res=await api.post('/api/auth/register',userData);const{token:newToken,user:newUser}=res.data;localStorage.setItem('token',newToken);setToken(newToken);setUser(newUser);return{success:true};}catch(error){var _error$response4,_error$response5,_error$config2,_error$response6;console.error('Registration error:',error);console.error('Error details:',{message:error.message,response:(_error$response4=error.response)===null||_error$response4===void 0?void 0:_error$response4.data,status:(_error$response5=error.response)===null||_error$response5===void 0?void 0:_error$response5.status,config:(_error$config2=error.config)===null||_error$config2===void 0?void 0:_error$config2.url});// Enhanced error handling with field-specific errors\nconst responseData=((_error$response6=error.response)===null||_error$response6===void 0?void 0:_error$response6.data)||{};const errorMessage=responseData.message||error.message||'Registration failed. Please check your connection.';const errorArray=Array.isArray(responseData.errors)?responseData.errors:[];const field=responseData.field||null;return{success:false,message:errorMessage,errors:errorArray,field:field};}};const logout=()=>{localStorage.removeItem('token');setToken(null);setUser(null);// Token is automatically removed from requests via interceptor\n};return/*#__PURE__*/_jsx(AuthContext.Provider,{value:{user,loading,login,register,logout,fetchUser},children:children});};export default AuthContext;","map":{"version":3,"names":["React","createContext","useState","useEffect","api","jsx","_jsx","AuthContext","AuthProvider","_ref","children","user","setUser","loading","setLoading","token","setToken","localStorage","getItem","fetchUser","res","get","data","error","removeItem","login","username","password","post","newToken","userData","setItem","success","_error$response","_error$response2","_error$config","_error$response3","_error$response3$data","console","message","response","status","config","url","register","newUser","_error$response4","_error$response5","_error$config2","_error$response6","responseData","errorMessage","errorArray","Array","isArray","errors","field","logout","Provider","value"],"sources":["/Users/ashishpimple/Desktop/GIT/client/src/context/AuthContext.js"],"sourcesContent":["import React, { createContext, useState, useEffect } from 'react';\nimport api from '../config/axios';\n\nconst AuthContext = createContext();\n\nexport const AuthProvider = ({ children }) => {\n  const [user, setUser] = useState(null);\n  const [loading, setLoading] = useState(true);\n  const [token, setToken] = useState(localStorage.getItem('token'));\n\n  useEffect(() => {\n    if (token) {\n      fetchUser();\n    } else {\n      setLoading(false);\n    }\n  }, [token]);\n\n  const fetchUser = async () => {\n    try {\n      const res = await api.get('/api/auth/me');\n      setUser(res.data);\n    } catch (error) {\n      localStorage.removeItem('token');\n      setToken(null);\n    } finally {\n      setLoading(false);\n    }\n  };\n\n  const login = async (username, password) => {\n    try {\n      const res = await api.post('/api/auth/login', { username, password });\n      const { token: newToken, user: userData } = res.data;\n      localStorage.setItem('token', newToken);\n      setToken(newToken);\n      setUser(userData);\n      return { success: true };\n    } catch (error) {\n      console.error('Login error:', error);\n      console.error('Error details:', {\n        message: error.message,\n        response: error.response?.data,\n        status: error.response?.status,\n        config: error.config?.url\n      });\n      return {\n        success: false,\n        message: error.response?.data?.message || error.message || 'Login failed. Please check your connection.'\n      };\n    }\n  };\n\n  const register = async (userData) => {\n    try {\n      const res = await api.post('/api/auth/register', userData);\n      const { token: newToken, user: newUser } = res.data;\n      localStorage.setItem('token', newToken);\n      setToken(newToken);\n      setUser(newUser);\n      return { success: true };\n    } catch (error) {\n      console.error('Registration error:', error);\n      console.error('Error details:', {\n        message: error.message,\n        response: error.response?.data,\n        status: error.response?.status,\n        config: error.config?.url\n      });\n      // Enhanced error handling with field-specific errors\n      const responseData = error.response?.data || {};\n      const errorMessage = responseData.message || error.message || 'Registration failed. Please check your connection.';\n      const errorArray = Array.isArray(responseData.errors) ? responseData.errors : [];\n      const field = responseData.field || null;\n      \n      return {\n        success: false,\n        message: errorMessage,\n        errors: errorArray,\n        field: field\n      };\n    }\n  };\n\n  const logout = () => {\n    localStorage.removeItem('token');\n    setToken(null);\n    setUser(null);\n    // Token is automatically removed from requests via interceptor\n  };\n\n  return (\n    <AuthContext.Provider value={{ user, loading, login, register, logout, fetchUser }}>\n      {children}\n    </AuthContext.Provider>\n  );\n};\n\nexport default AuthContext;\n\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}